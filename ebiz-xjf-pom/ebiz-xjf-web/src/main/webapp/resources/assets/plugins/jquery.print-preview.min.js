/*!
 * jQuery Print Previw Plugin v1.0.1
 *
 * Copyright 2011, Tim Connell
 * Licensed under the GPL Version 2 license
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * Date: Wed Jan 25 00:00:00 2012 -000
 */
(function(e){e.fn.printPreview=function(){this.each(function(){e(this).bind("click",function(f){f.preventDefault();if(!e("#print-modal").length){e.printPreview.loadPrintPreview()}})});return this};var b,c,a,d;e.printPreview={loadPrintPreview:function(){a=e('<div id="print-modal"></div>');d=e('<div id="print-modal-controls"><a href="#" class="print"  title="��ӡ">pirnt</a><a href="#" class="close"  title="�ر�">colse</a>').hide();var f=e('<iframe id="print-modal-content" scrolling="no" border="0" frameborder="0" name="print-frame" />');a.hide().append(d).append(f).appendTo("body");for(var j=0;j<window.frames.length;j++){if(window.frames[j].name=="print-frame"){var l=window.frames[j].document;break}}l.open();l.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><title>'+document.title+"</title></head><body></body></html>");l.close();var k=e("head link[media*=print], head link[media=all]").clone(),g=e("body > *:not(#print-modal):not(script)").clone();k.each(function(){e(this).attr("media","all")});if(!e.browser.msie&&!(e.browser.version<7)){e("head",l).append(k);e("body",l).append(g)}else{e("body > *:not(#print-modal):not(script)").clone().each(function(){e("body",l).append(this.outerHTML)});e("head link[media*=print], head link[media=all]").each(function(){e("head",l).append(e(this).clone().attr("media","all")[0].outerHTML)})}e("a",l).bind("click.printPreview",function(i){i.preventDefault()});e("head").append('<style type="text/css">@media print {/* -- Print Preview --*/#print-modal-mask,#print-modal {display: none !important;}}</style>');e.printPreview.loadMask();e("body").css({overflowY:"hidden",height:"100%"});e("img",l).load(function(){f.height(e("body",f.contents())[0].scrollHeight)});starting_position=e(window).height()+e(window).scrollTop();var h={top:starting_position,height:"100%",overflowY:"auto",zIndex:10000,display:"block"};a.css(h).animate({top:e(window).scrollTop()},400,"linear",function(){d.fadeIn("slow").focus()});f.height(e("body",f.contents())[0].scrollHeight);e("a",d).bind("click",function(i){i.preventDefault();if(e(this).hasClass("print")){window.print()}else{e.printPreview.distroyPrintPreview()}})},distroyPrintPreview:function(){d.fadeOut(100);a.animate({top:e(window).scrollTop()-e(window).height(),opacity:1},400,"linear",function(){a.remove();e("body").css({overflowY:"auto",height:"auto"})});b.fadeOut("slow",function(){b.remove()});e(document).unbind("keydown.printPreview.mask");b.unbind("click.printPreview.mask");e(window).unbind("resize.printPreview.mask")},loadMask:function(){c=e.printPreview.sizeUpMask();b=e('<div id="print-modal-mask" />').appendTo(e("body"));b.css({position:"absolute",top:0,left:0,width:c[0],height:c[1],display:"none",opacity:0,zIndex:9999,backgroundColor:"#000"});b.css({display:"block"}).fadeTo("400",0.75);e(window).bind("resize..printPreview.mask",function(){e.printPreview.updateMaskSize()});b.bind("click.printPreview.mask",function(f){e.printPreview.distroyPrintPreview()});e(document).bind("keydown.printPreview.mask",function(f){if(f.keyCode==27){e.printPreview.distroyPrintPreview()}})},sizeUpMask:function(){if(e.browser.msie){var g=e(document).height(),f=e(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,g-f<20?f:g]}else{return[e(document).width(),e(document).height()]}},updateMaskSize:function(){var f=e.printPreview.sizeUpMask();b.css({width:f[0],height:f[1]})}}})(jQuery);